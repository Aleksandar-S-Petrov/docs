---
title: 07. Топология
tags: вектор, топология, топологични правила, топологични грешки, залепване
---

# Топология

## Преглед

**Топологията** описва пространствените връзки между свързани или съседни векторни обекти.
Анализирането на топологията на даден векторен слой може да открие и поправи редица грешки, които лесно могат да се допуснат при цифроване.
Например два пътя не се допират в обща точка при кръстовище, а има леко разминаване.
При пространствен анализ на транспортната мрежа това би било критичен проблем.

Представете си, че пътуваме до Лондон.
Туристическата обиколка включва посещение на катедралата Свети Павел, а следобеда селфи пред Бъкингамския дворец.
За да пристигнем навреме ще използваме метрото, но първо трябва да се ориентирате по схемата на различните метролинии.
Това изисква информация за топологията на кои станции може да се прехвърлим от една линия на друга.
На тази карта подобни взаимовръзки са показани с кръгчета, които означават, че е възможен трансфер тук.

![Карта на Лондонското метро.](img/london_underground.png)

## Топологични грешки

Топологичните грешки са сред най-неприятните реалности от ГИС ежедневието.

При полигоните подобни грешки включват незатворени многоъгълници, празни пространства или застъпване между два съседни полигона, или два полигона с обща граница имат различен брой **възли** по общата си граница.

<!-- TODO примери с незатворени многоъгълници, застъпвания или дупки между полигони, различен брой възли по границите -->

При линиите най-често се получава разминаване при допиране на двете линии, вместо да споделят общ възел. Ако линията не достига крайната си точка, това се нарича **недостигане (undershoot)**, а минава отвъд нея **задминаване (overshoot)**.

<!-- TODO примери с линии, които не се допират на правилните места -->

<!-- TODO примери с линии, които се пресичат като спагети, и нямат обща точка при пресичането си -->

![Недостигане (1) се получава, когато цифрованите линии, които трябва да се допират всъщност не го правят. Задминаване (2) се получава, ако линията пресича и свършва след линията, с която трябва да се свърже. Дупки (3) се получават, когато вертексите на два полигона не съвпадат върху техните граници.](img/topology_errors.png)

В резултат от недостигането или задминаването се получават така наречените висящи възли на края на линиите.
Висящите възли не винаги са сигнал за грешна топология, например при задънена улица, начало на река и прочие.

Топологичните грешки трябва да бъдат избягвани, тъй като водят до нарушена свързаност между обектите.
Те трябва да бъдат отстранени, за да може да се извърши пълноценен анализ на данните.
При нарушена топология мрежовия анализ (напремер най-краткия път до най-близката дюнерджийница) или измерване (например дължината на дадена река) ще са крайно неточни.

Представете си че имате слой с областите в България, но полигоните са с нарушена топология и има дупки или припокриват.
Сумиранет на площите на областите в България би трябвало да даде общата площ на страната, но в този случай ще има разминаване.

Накратко - топологията винаги трябва да бъде спазена, иначе данните не подлежат на анализ!

## Топологични правила

Много от описаните топологични грешки могат да бъдат избегнати благодарение на вградените функционалности на ГИС приложенията за прилагане на топологични правила.

С изключение на някои специфични ГИС формати, топологията не е задължителна по подразбиране.
Много популярни ГИС приложения, включително QGIS, дават възможност на потребителя да избере кои топологични правила да се прилагат.

Ето примерен списък на топологични правила, които обикновено се следват при работа с пространствени данни:

- Площите на общините не трябва да се пресичат.
- Площите на общините не трябва да оставят празни пространства помежду си.
- Полигоните на общините трябва да са затворени.
- Изолиниите на релефа не бива да се пресичат.

## Топологични инструменти

Различните ГИС приложения предлага различни инструменти за редакция спазваща топологичните правила.
В QGIS потребителят трябва да **включи топологичното редактиране**, при което редакцията и добавянето на нови обекти ще следва определени топологични правила.
Така QGIS ще открие автоматично съвпадащите вертекси, линии и граници на полигони.
При преместване на точка от един обект от даден слой, ще се премести съвпадащите точки от другите обекти в този и останалите слоеве.

Друга опция на топологичните инструменти в QGIS предпазва от застъпващи се полигони по време на цифроване.
Ако вече има цифрован полигон, тази опция позволява да се изчертае нов съседен полигон, който частично застъпва вече съществуващия, но накрая QGIS ще изреже съвпадащата част.

![(1) Топологично редактиране открива споделени граници между полигоните, когато се преместват вертекси. Всички обекти които споделят даден вертекс ще бъдат с променена геометрия при преместване на вертекса. (2) При изчертаване на нов полигон (в червено), QGIS ще ни предпазви от застъпване на двата полигона като изреже общата част.](img/topological_tools.png)


## Разстояние на прилепване

**Разстоянието на прилепване** в ГИС е настройка на разстоянието за откриване на най-близкия вертекс и/или сегмент, към който да се залепи текущо редактирания вертекс.
**Сегмент** е правата линия, образуваната между два вертекса в линия или полигон.
Там където два или повече вертекса съвпадат се нарича **възел**.
Ако тещущо редактирания вертекс не попада в разстоянието на прилепване, ГИС софтуера ще го остави там където е поставен с курсора на мишката, вместо да го залепи за най-близки вертекст или сегмент.

![Разстоянието на прилепване (черния кръг) се измерва в картни единици (например десетични градуси или метри) за прилепване към вертекси или сегменти.](img/snapping_distance.png)


## Радиус на търсене

Радиусът на търсене е разстоянието, в което QGIS търси най-близкия вертекс, когато се натисне върху картата.
Радиусът на търсене и разстоянието на прилепване са много близки по смисъл.

Разстоянието на прилепване и радиусът на търсене се настройват в картни единици.
За откриването на подходящите стойности на настройката са необходими експерименти за предпочитанията на ГИС потребителя.
Ако стойността е прекалено висока, ГИС приложението ще прилепва вертексите на грешно място, особено при слоеве с множество вертекси.
Ако е прекалено ниска, ГИС приложението няма да открива лесно точкови или линейни обекти по време.

## Препъникамъчета

Поради сложността на геометричните операции необходими за спазване на топологията, повечето ГИС приложения не зачитат топологията по подразбиране.
Поради тази причина топологичното редактиране трябва да бъде изрично включено при редакция на геометрията на обектите.

## Какво научихме?

Нека обобщим:

- Топологията показва пространствените взаимовръзки между съседни векторни обекти.
- Топологията в ГИС се управлява с различни топологични инструменти.
- Топологията позволява откриването и поправката на грешки при цифроване.
- **Възел** се наричат съвпадащи вертекси от два или повече обекта.
- **Сегмент** се нарича правата линия образувана между два последователни вертекса в линия или полигон.
- При някои видове анализи, например **най-кратък път** или други задачи за **анализ на мрежи**, правилната топология е критична.
- За улеснение при цифроване се използват инструменти за автоматично **прилепване**, на които може да се настрои **разстояние за прилепване** и **радиус на търсене**.
- Повечето ГИС софтуери и формати не използват топологични граници на обектите, за да работят по-бързо и да бъдат по-опростени.

## Практика!

- Маркирайте маршрутите на линиите публичен транспорт във вашия град с различен цвят и отблележете спирките. Разиграйте различни комбинации за пропътуване между две спирки на различни линии на транспорта.
- Какви топологични правила трябва да се спазват, когато се изчертава пътната мрежа на дадено селище или държава?
