---
title: Средни височини
tags: exercise, processing, modeller, algorithms
---

# Средни височини

Целта е да се изготви QGIS модел, с който да се генерира нов слой с готова симвология със средната надморска височина по общини. Този QGIS модел приема за вход векторен слой с общините, растерен слой с цифровия модел на релефа и .qml файл със стиловете, а при изпълнение на модела да се генерира нов слой с общините, оцветени според зададения стил.

Всъщност звучи страшно сложно, но не е чак толкова.

При наличието на такъв QGIS модел, независимо от избраните векторен и растерен слой, винаги може да бъде създаден нов слой със средната надморска височина на общините, областите, държавите и т.н слой с полигони. Независимо дали било то в България, било то в Румъния, или нещо друго.

## Основна цел
Да се затвърди възможността за създаване на автоматизирани модели с множество стъпки.

## Цели
- Изтегляне на данни от OSM
- Търсене на свободни данни с цифров модел на релефа
- Работа с processing toolbox в QGIS
- Изрязване и обединяване на растери
- Изчисляване на ново поле във векторен слой по данни от растерен
- Дефиниране и експортиране на собствен стил в QGIS
- Дефиниране на собствен модел в QGIS

## Резултат
При успешно завършена задача да се споделят четири файла:
- municipalities.gpkg - слой само с общините и нищо друго;
- bulgaria_dem.tif - цифров модел на релефа, който съвпада с пространствения обхват на слоя с общините.
- avg_altitude.qml - файл, в който е дефинирана символогията. Бонус точки, ако символогията незадължителен входен параметър.
- avg_altitude_generator.model3 - дефиницията на модела в QGIS, най-важния файл за упражнението, другите три са само за удобство на проверяващия
Да се качат в личната директория в нова поддиректория с името "avg_altitudes", а всяка отделна версия във формат година-месец-дата, например 2021-12-24 с всички необходими файлове.

## Източници на данни
Векторните данни могат да се набавят от OSM.
Единственият (TODO не съвсем EU-DEM използва SRTM и ASTER GDEM) цифров модел на релефа (Digital Elevation Model, DEM), достъпен за България е от SRTM.

## Стъпки
1) изглеглят се данните за общините QuickOSM
2) изтегля се цифровия модел на релефа за страната. При необходимост се изразвя или слепва, така че да се получи един единствен .tif с необходимата информация, която да покрива само територията на общините.
3) с един от алгоритмите в processing toolbox-а се изчислява средната надморска височина по общини (нарочно не се дава името на алгоритъма в момента, да се потърси)
4) задава се подходяща симвология на слоя с общините по средна надморска височина. Предполагат се поне 5-6 стъпки през 200 метра.
5) запазва се новосъздадената симвология в .qml файл
6) с model designer се създава нов модел avg_altitude_generator.
6.1) вход - слой векторен слой с полигони, слоя с цифровия модел на релефа и .qml файла със стиловете.
6.2) стъпките, които ръчно са направени в 3 и 4, се правят със съответните алгоритми, налични в списъка на model designer-а
6.3) изход - векторен с слой с правилно зададен стил
6.4) БОНУС ТОЧКИ!!! - задаването на .qml файл със стиловете да бъде незадължително и модела да работи правилно (conditionals).

## Препоръки
Най-трудните и вероятно нови стъпки са 2, 3, и 6. Да не се подценява стъпка 6, може да отнеме най-половината от даденото време при липса на опит с тази функционалност.

## Време за изпълнение
За опитен потребител 0:45 ч.
За запознат потребител 3 ч.
За незапознат потребител 16 ч.

## Задължителни материали за четене
- https://en.wikipedia.org/wiki/Digital_elevation_model - без секцията sources.
- https://docs.qgis.org/3.16/en/docs/training_manual/qgis_plugins/plugin_examples.html#basic-fa-the-quickosm-plugin - 9.2.2
- https://docs.qgis.org/3.16/en/docs/user_manual/introduction/general_tools.html?highlight=save%20qml%20style#storing-styles-in-a-file-or-a-database 11.6.2
- https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasteranalysis.html?highlight=zonal%20statistics#zonal-statistics - 23.1.9.19
- https://docs.qgis.org/3.16/en/docs/user_manual/processing/modeler.html?highlight=model%20designer

## Незадължителни подробни примери
- https://docs.qgis.org/3.16/en/docs/training_manual/processing/modeler_twi.html
- https://docs.qgis.org/3.16/en/docs/training_manual/processing/modeler_hydro.html

## Незадължителни допълнителни материали
- https://gisgeography.com/dem-dsm-dtm-differences/

## Срок на изпълнение
Както винаги, срокът на задачата е 24:00 на първата неделя след две седмици (14 дни).

## Обратна връзка
Естествено, веднъж седмично може да обсъдим нещата. Веднъж дневно също мога да отговарям на кратки въпроси. Прозорец от три дни за уточняващи въпроси по условието.

